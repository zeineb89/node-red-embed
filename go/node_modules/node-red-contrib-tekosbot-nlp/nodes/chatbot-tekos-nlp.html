<!--
  Copyright 2013, 2016 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="tekos-nlp">
    <div class="form-row">
        <label for="node-input-url"><i class="fa fa-globe"></i> <span> URL </span></label>
        <input type="text" id="node-input-url" placeholder="http://">
    </div>

    <div class="form-row node-input-token">
        <label for="node-input-token"><i class="fa fa-key"></i> <span >Token</span></label>
        <input type="text" id="node-input-token" placeholder="Token or use flow.set('Token',...)">
    </div>
   <!--  <div class="form-row node-input-uid">
        <label for="node-input-uid"><i class="fa fa-id-card-o"></i> <span >Variable uid</span></label>
        <input type="text" id="node-input-uid">
    </div> -->
     <div class="form-row node-input-option">
        <label for="node-input-option"><i class="fa fa-filter"></i>Option</label>
        <select type="text" id="node-input-option" style="width:70%;">
        <option value="parse">Parse</option>
        <option value="continue">Continue</option>
        </select>
    </div>
    <!-- <div class="form-row node-input-msg">
        <label for="node-input-msg"><i class="fa fa-commenting-o"></i> <span >Message</span></label>
        <input type="text" id="node-input-msg">
    </div> --> 
    <!--<div class="form-row node-input-action">
        <label for="node-input-action"><i class="fa fa-tasks"></i> <span >Executed action</span></label>
        <input type="text" id="node-input-action">
    </div> --> 
   

    <!-- <div class="form-row">
        <input type="checkbox" id="node-input-follow-redirects" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-follow-redirects" style="width: auto">Follow redirects</label>
    </div>

    <div class="form-row">
        <input type="checkbox" id="node-input-usetls" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-usetls" style="width: auto">Enable secure (SSL/TLS) connection</label>
        <div id="node-row-tls" class="hide">
            <label style="width: auto; margin-left: 20px; margin-right: 10px;" for="node-input-tls"><span>TLS Configuration</span></label><input type="text" style="width: 300px" id="node-input-tls">
        </div>
    </div>

    <div class="form-row">
        <input type="checkbox" id="node-input-useAuth" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-useAuth" style="width: 70%;"><span>Use basic authentication</span></label>
        <div style="margin-left: 20px" class="node-input-useAuth-row hide">
            <div class="form-row">
                <label for="node-input-user"><i class="fa fa-user"></i> <span>Username</span></label>
                <input type="text" id="node-input-user">
            </div>
            <div class="form-row">
                <label for="node-input-password"><i class="fa fa-lock"></i> <span>Password</span></label>
                <input type="password" id="node-input-password">
            </div>
        </div>
    </div> 

    <div class="form-row">
        <label for="node-input-ret"><i class="fa fa-arrow-left"></i> <span>Return</span></label>
        <select type="text" id="node-input-ret" style="width:70%;">
        <option value="txt">a UTF-8 string</option>
        <option value="bin">a binary buffer</option>
        <option value="obj">a parsed JSON object</option>
        </select>
    </div> --> 
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span>Name</span></label>
        <input type="text" id="node-input-name">
    </div>
    <div class="form-tips" id="tip-json" hidden><span>Tip: If the JSON parse fails the fetched string is returned as-is.</span></div>
</script>

<script type="text/x-red" data-help-name="tekos-nlp">
    <p>Tekos NLP node</p>
    <p>Access to Tekos Natural Language Processingservice at <a href="http://tekos.co/nlp" target="_new">tekos.co/nlp</a></p>

    <b>Input</b>
    <p>By default, it accepts <code>msg.payload.query </code>as the query and send it to Tekos NLP:</p>
    <!-- <p><code>http://tekos.co/api?token=TOKEN?q={{{payload}}}</code></p> --> 
    <b>Output</b>
    <p><code>msg.payload</code> stores the raw output from Tekos NLP.</p>
</script>

<script type="text/javascript">
    RED.nodes.registerType('tekos-nlp',{
        category: 'Natural Language Processing',
        color: '#7ed3b2',
        defaults: {
            name: {value:""},
            token: {value: null},
            method:{value:"POST"},
            uid:{value:""},
            msg:{value:""},
            action: {value:""},
            option:{value:"parse"},
            ret: {value:"txt"},
            url:{value:""},
            "follow-redirects":{value:true},
            tls: {type:"tls-config",required: false}
        },
        credentials: {
            user: {type:"text"},
            password: {type: "password"}
        },
        inputs:1,
        outputs:1,
        icon: "white-globe.png",
        label: function() {
            return this.name|| "Tekos NLP";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            $("#node-input-useAuth").change(function() {
                if ($(this).is(":checked")) {
                    $(".node-input-useAuth-row").show();
                } else {
                    $(".node-input-useAuth-row").hide();
                    $('#node-input-user').val('');
                    $('#node-input-password').val('');
                }
            });
            $("#node-input-option").change(function () {
            var id = $("#node-input-option option:selected").val();
            if (id === "parse") {
                $(".node-input-action").hide();
                $(".node-input-msg").show();
            }else {
                $(".node-input-action").show();
                $(".node-input-msg").hide();
            }
        });
            if (this.credentials.user || this.credentials.has_password) {
                $('#node-input-useAuth').prop('checked', true);
            } else {
                $('#node-input-useAuth').prop('checked', false);
            }
            $("#node-input-useAuth").change();

            function updateTLSOptions() {
                if ($("#node-input-usetls").is(':checked')) {
                    $("#node-row-tls").show();
                } else {
                    $("#node-row-tls").hide();
                }
            }
            if (this.tls) {
                $('#node-input-usetls').prop('checked', true);
            } else {
                $('#node-input-usetls').prop('checked', false);
            }
            updateTLSOptions();
            $("#node-input-usetls").on("click",function() {
                updateTLSOptions();
            });
            $("#node-input-ret").change(function() {
                if ($("#node-input-ret").val() === "obj") {
                    $("#tip-json").show();
                } else {
                    $("#tip-json").hide();
                }
            });
        },
        oneditsave: function() {
            if (!$("#node-input-usetls").is(':checked')) {
                $("#node-input-tls").val("_ADD_");
            }
        }
    });
</script>