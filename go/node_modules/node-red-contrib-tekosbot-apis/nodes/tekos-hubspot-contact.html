<!-- ***************** Hubspot Contact *********************** -->

<script type="text/x-red" data-help-name="Hubspot Contact">
    <h6>Hubspot Contact :</h6>
    <p>Hubspot Contact to manage your contacts</p>
    <p><b>get()</b> : to get all contacts</p>
    <p><b>create()</b> : to create a new contact. The properties can be passed in the form or in msg.payload :</p>
    <p><u><i>msg.payload</i></u> = [<br>
            { "property": "firstname", "value": "John" },<br>
            { "property": "lastname", "value": "DOE" },<br>" 
            { "property": "email", "value": "John@tekos.co}<br>
            ]<br></p>
    <p><b>getByEmail()</b> : to get one contact, the email passed in msg.payload</p>
    <p><b>update()</b> : to update an existant contact, the email of the contact you want to update passed in msg.payload and the new object in msg.data </p>
    <p><u><i>msg.payload</i></u> = "John@tekos.co"<br> 
    <p><u><i>msg.data</i></u> = {<br>
        "properties" :[<br>
            { "property": "firstname", "value": "newvalue" },<br>
            { "property": "email", "value": "updated@tekos.co" }<br>
            ]<br>
    }<br></p>
    <p><b>delete()</b> : to delete an existant contact, the email passed in msg.payload.</p>
    <p>For more information, visit this link : <a href="https://developers.hubspot.com/docs/methods/contacts/contacts-overview"> Hubspot docs</a></p>

</script>

<script type="text/javascript">
    
    RED.nodes.registerType('Hubspot Contact',{
        category: 'APIs',
        color:"#fed9ca",
        defaults: {        
            name: {value: ""},
            operation: {
              value: 'get'
            },
            options: {
            value:[{value:'', label :'', type:'', required:true}],

            },
            proprieties: {},
            email: {value: ''},
            firstname:{value: ''},
            lastname:{value: ''},
            website:{value: ''},
            company: {value: ''},
            phone: {value: ''},
            address:{value: ''},
            city: {value: ''},
            state: {value: ''},
            zip: {value: ''},            
            payload: {value: ''},
            topic: {value: ''},
            hubspotApp: {type:"hubspot-app",required:true},
        },
        inputs:1,
        outputs:1,
        icon: "chatbot-waiting.png",
        align: 'left',
        paletteLabel: 'Hubspot Contact',
        label: function() {
            return this.name||"Hubspot Contact";
        },
        labelStyle: function() {
            return (this.name)?"node_label_italic":"";
        },
        oneditprepare: function oneditprepare() {
          $('#node-input-operation').on('change', ()=>{
          if($('#node-input-operation').val() == 'create'){
            $("#form-create").show()
          }else{
            $("#form-create").hide()

          }
          });
        var node = this;
        
    },
    oneditsave: function() {
        var options = $("#node-input-option-container").children();
        var node = this;
        let property = $("#node-container-properties");
        var o = {};
        node.options = [];
        node.formValue = {};
         
        let proprieties = {
            email: $("#node-input-email").val(),
            firstname: $("#node-input-firstname").val(),
            lastname: $("#node-input-lastname").val(),
            website: $("#node-input-website").val(),
            company: $("#node-input-company").val(),
            phone: $("#node-input-phone").val(),
            address: $("#node-input-address").val(),
            city: $("#node-input-city").val(),
            state: $("#node-input-state").val(),
            zip: $("#node-input-zip").val(),
        }
        node.proprieties = proprieties
    }
});
   
</script>

<script type="text/x-red" data-template-name="Hubspot Contact">
  <div class="form-row">
        <label for="node-input-hubspotApp" style="width: 110px;"><i class="fa fa-bookmark"></i> App Hubspot </label>
        <input type="text" id="node-input-hubspotApp">
    </div>
     <div class="form-row">
      <label for="node-input-operation" style="width: 110px;"><i class="icon-tag"></i> Method </label>
      <select id="node-input-operation">
        <option value="get">Get</option>
        <option value="getByEmail">GetByEmail</option>
        <option value="create">Create</option>
        <option value="update">Update</option>
        <option value="delete">Delete</option>
      </select>
    </div>

    <div class="form-row">
        <label for="node-input-name" style="width: 110px;margin-bottom: 20px"><i class="fa fa-tag"></i> Name </label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div id="form-create">
        <label style="vertical-align:top;margin-bottom: 10px"><i class="fa fa-list-alt"></i> Contact Proprieties </label>
        <div class="form-row node-input-option-container-row" style="margin-bottom:50px; width:200px; min-width:520px">
            <div id="node-container-properties" style="border-top:1px solid #ccc;">
                <div style=" height: 50px; padding: 5px;margin-bottom: 10px">
                  <label for="node-input-email" style="width: 110px;"> Email </label>
                  <input type="email" id="node-input-email" placeholder="email@tekos.co">
                </div> 
                <div style=" height: 50px; padding: 5px">
                  <label for="node-input-firstname" style="width: 110px;list-style-type:none; margin: 0;"> Firstname </label>
                  <input type="text" id="node-input-firstname" placeholder="firstname">
                </div>
                <div style=" height: 50px; padding: 5px;">
                  <label for="node-input-lastname" style="width: 110px;list-style-type:none; margin: 0;"> Lastname </label>
                  <input type="text" id="node-input-lastname" placeholder="lastname">
                </div>
                 <div style=" height: 50px; padding: 5px;">
                  <label for="node-input-website" style="width: 110px;"> Website </label>
                  <input type="text" id="node-input-website" placeholder="website">
                </div>
                 <div style=" height: 50px; padding: 5px;">
                  <label for="node-input-company" style="width: 110px;"> Company </label>
                  <input type="text" id="node-input-company" placeholder="company">
                </div>
                 <div style=" height: 50px; padding: 5px;">
                  <label for="node-input-phone" style="width: 110px;"> Phone </label>
                  <input type="text" id="node-input-phone" placeholder="phone">
                </div>
                 <div style=" height: 50px; padding: 5px;">
                  <label for="node-input-address" style="width: 110px;"> Address </label>
                  <input type="text" id="node-input-address" placeholder="address">
                </div>
                 <div style=" height: 50px; padding: 5px;">
                  <label for="node-input-city" style="width: 110px;"> City </label>
                  <input type="text" id="node-input-city" placeholder="city">
                </div>
                 <div style=" height: 50px; padding: 5px;">
                  <label for="node-input-state" style="width: 110px;"> State </label>
                  <input type="text" id="node-input-state" placeholder="state">
                </div>
                 <div style=" height: 50px; padding: 5px;">
                  <label for="node-input-zip" style="width: 110px;"> Zip </label>
                  <input type="text" id="node-input-zip" placeholder="zip">
                </div>           
            </div>
        </div>
    </div>
</script>

<!-- ***************** Hubspot Engagement *********************** -->

<script type="text/x-red" data-help-name="Hubspot Engagement">
    <h6>Hubspot Engagement :</h6>
    <p>Hubspot Engagement to manage your Engagements</p>
    <p><b>get()</b> : to get all Engagements</p>
    <p><b>create()</b> : to create a new Engagement.<br>The data could be passed in msg.payload with these required parameters<br>
    <u><i>msg.payload</i></u> = {<br>
        "ownerId": OwnerId,<br>
        "body": "Here the body of the engagement",<br>
        "subject": "Title of engagement",<br>
        "status": "IN_PROGRESS",<br>
    }<br>
    The status needs to be NOT_STARTED, COMPLETED, IN_PROGRESS, WAITING, or DEFERRED.</p>
    <p><b>getRecentlyModified()</b> : to get recently modified engagements : </p>
    <p><u><i>Count</i></u>: The number of items to include in the response. Defaults to 20, has a maximum value of 100.</p>
    <p><u><i>Offset</i></u> : Used to page through the recent engagements. Each response will include an offset value that can be used with this parmaeter to get the next set of records..</p>
    <p><u><i>Since</i></u> : If this parameter is included, only records modified after the specified time will be returned.</p>
</script>

<script type="text/javascript">
    
    RED.nodes.registerType('Hubspot Engagement',{
        category: 'APIs',
        color:"#fed9ca",
        defaults: {
            name: {value: ""},
            operation: {
              value: 'get'
            },
            options: {
            value:[{value:'', label :'', type:'', required:true}],

        },
        uid: {value: "", required:true},
        body: {value: "", required:true},
        subject: {value: "", required:true},
        status: {value: "NOT_STARTED", required:true},
        engagementType: {value: "TASK", required:true},
        count: {value: ""},
        offset: {value: ""},
        date: {value: ""},
        time: {value: ""},
        payload: {value: ''},
        topic: {value: ''},
        hubspotApp: {type:"hubspot-app",required:true},
        },
        inputs:1,
        outputs:1,
        icon: "chatbot-waiting.png",
        align: 'left',
        paletteLabel: 'Hubspot Engagement',
        label: function() {
            return this.name||"Hubspot Engagement";
        },
        labelStyle: function() {
            return (this.name)?"node_label_italic":"";
        },
        oneditprepare: function() {
          $('#node-input-operation').on('change', ()=>{

            if($('#node-input-operation').val() == 'create'){
              $("#form-create").show()
            }else{
              $("#form-create").hide()
            }

             if($('#node-input-operation').val() == 'getRecentlyModified'){
              $("#form-getRecently").show()
            }else{
              $("#form-getRecently").hide()
            }

          });
    },
    oneditsave: function() {
        var node = this;
        var o = {};
        node.formValue = {};

        console.log("node ******************************************************")
        console.log(node)
        options.each(function(i) {
            var option = $(this);
            var o = {
                label: option.find(".node-input-option-label").val(),//typedInput('value'),
                value: option.find(".node-input-option-value").val(),//typedInput('value'),
                type: option.find(".node-input-option-type").val(),//typedInput('value')
                list: option.find(".node-input-option-list").val(),//typedInput('value')
                // required: option.find(".node-input-option-required").is(':checked')
            };
            o.value= o.value||o.label||(o.type+"_"+i);
            node.formValue[o.value]= o.type == "checkbox" || o.type == "switch" ? false : "";
            node.options.push(o);
            //console.log(o);
        });
        // update metadata in database and variable
        // fetch metadata at the beginning of the request
    }
    });
   
</script>

<script type="text/x-red" data-template-name="Hubspot Engagement">
  <div class="form-row">
        <label for="node-input-hubspotApp" style="width: 110px;"><i class="fa fa-bookmark"></i> App Hubspot </label>
        <input type="text" id="node-input-hubspotApp">
    </div>
     <div class="form-row">
      <label for="node-input-operation" style="width: 110px;"><i class="icon-tag"></i> Method </label>
      <select id="node-input-operation">
        <option value="get">Get</option>
        <option value="create">Create</option>
        <option value="getRecentlyModified">getRecentlyModified</option>
        <!--<option value="getCallDispositions">getCallDispositions</option>-->
      </select>
    </div>

    <div class="form-row">
        <label for="node-input-name" style="width: 110px;"><i class="fa fa-tag"></i> Name </label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div id="form-create">
    <div class="form-row node-input-option-container-row" style="margin-bottom:0px; width:100%; min-width:520px">
        <label style="vertical-align:top;"><i class="fa fa-list-alt"></i> Task Details </label>
        <div style=" border-top:1px solid #ccc; border-radius:5px; box-sizing:border-box;">
        <div style=" height: 50px; padding: 5px;">
          <label for="node-input-engagementType" style="width: 110px;"> Type </label>
            <select id="node-input-engagementType">
                <option value="TASK">TASK</option>
            </select>
        </div> 
        <div style=" height: 50px; padding: 5px">
          <label for="node-input-uid" style="width: 110px;list-style-type:none; margin: 0;"> Assigned to </label>
          <input type="text" id="node-input-uid" placeholder="add the ownerId of the task">
        </div>
        <div style=" height: 50px; padding: 5px;">
          <label for="node-input-body" style="width: 110px;list-style-type:none; margin: 0;"> Body </label>
          <input type="text" id="node-input-body" placeholder="add the body of the task">
          
        </div>

         <div style=" height: 50px; padding: 5px;">
          <label for="node-input-subject" style="width: 110px;"> Subject </label>
          <input type="text" id="node-input-subject" placeholder="add subject of the task">
        </div>


        <div style=" height: 50px; padding: 5px;">
          <label for="node-input-status" style="width: 110px;"> Status </label>
            <select id="node-input-status">
                <option value="NOT_STARTED">NOT STARTED</option>
                <option value="COMPLETED">COMPLETED</option>
                <option value="IN_PROGRESS">IN PROGRESS</option>
                <option value="WAITING">WAITING</option>
                <option value="DEFERRED">DEFERRED</option>
            </select>
        </div>            
        </div>
    </div>
    
    </div>
    <div id="form-getRecently">
    <div class="form-row node-input-option-container-row" style="margin-bottom:0px; width:100%; min-width:520px">
        <label style="vertical-align:top;"><i class="fa fa-list-alt"></i> Options </label>
        <div style="width:90%; border-top:1px solid #ccc;">
        <div style=" height: 50px; padding: 5px">
          <label for="node-input-count" style="width: 110px;list-style-type:none; margin: 0;"> Count </label>
          <select id="node-input-count">
                <option value="20">20</option>
                <option value="30">30</option>
                <option value="50">50</option>
                <option value="100">100</option>
            </select>
        </div>
        <div style=" height: 50px; padding: 5px">
          <label for="node-input-offset" style="width: 110px;list-style-type:none; margin: 0;"> Offset </label>
          <select id="node-input-offset">
                <option value="0">0</option>
                <option value="5">5</option>
                <option value="10">10</option>
                <option value="15">15</option>
                <option value="20">20</option>
            </select>
        </div>
        <div style=" height: 50px; padding: 5px;">
          <label for="node-input-since" style="width: 110px;list-style-type:none; margin: 0;"> Since </label>
          <div style="margin-left: 110px; margin-bottom: 20px">
            <input type="date" id="node-input-date" style="width: 45%;list-style-type:none; margin-right: 10px;">
            <input type="time" id="node-input-time" style="width: 45%;list-style-type:none; margin-right: 10px;">
          </div>
        </div>
            
        </div>
    </div>
  </div>
</script>
<!-- ***************** HUBSPOT APP CONFIG *********************** -->
<script type="text/x-red" data-template-name="hubspot-app">
    <div class="form-row">
        <label for="node-config-input-apiKey"><i class="fa fa-tag"></i>API Key</label>
        <input type="text" id="node-config-input-apiKey" placeholder="API Key" />
    </div>
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-config-input-name" placeholder="Name">
    </div>
  
</script>

<script type="text/javascript">
    RED.nodes.registerType('hubspot-app',{
        category: 'config',
        defaults: {
            apiKey: {
                value:"",
                required: true
            },       
            name: {}
        },
        label: function() {
            return this.name ;
        }
        
    });
</script>
