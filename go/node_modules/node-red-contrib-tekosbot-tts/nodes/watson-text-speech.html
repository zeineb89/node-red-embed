<script type="text/javascript">
  RED.nodes.registerType('watson-text-speech', {
    category: 'Text To Speech',
    color: '#bfd8d5',
    defaults: {
      name: {
        value: ''
      },
      message: {
        value: ['']
      },
      voice:{
        value: 9
      },
      apikey:{
        value: ''
      },
      endpoint: {
        value: 'https://stream-fra.watsonplatform.net/text-to-speech/api'
      },
      answer: {
        value: false
      },
      track: {
        value: false
      }
    },
    inputs: 1,
    outputs: 1,
    paletteLabel: 'Watson TTS',
    icon: 'chatbot-message.png',
    label: function() {
      return this.name || 'Watson TTS';
    },
    oneditsave: function() {
      var messages = $("#node-input-message-container").editableList('items');
      var node = this;
      node.message = [];

      var idx;
      for(idx = 0; idx < messages.length; idx++) {
        node.message.push({
          message: messages[idx].find('textarea').val()
        });
      }
    },

    oneditprepare: function() {
      $('#node-input-message-container')
        .css('min-height','300px')
        .css('min-width','450px')
        .editableList({
          addButton: 'Add message version',
          addItem: function (container, i, item) {
            var row = $('<div/>').appendTo(container);
            var content = '';
            if (typeof item == 'string') {
              content = item;
            } else if (item.message != null) {
              content = item.message;
            }
            $('<textarea placeholder="Message">' + content + '</textarea>')
              .css({
                width: '93%',
                height: '100px'
              })
              .appendTo(row);
          },
          removable: true,
          sortable: true
        });

      var message = this.message;
      if (typeof message == 'string') {
        message = [message];
      }
      var idx;
      for (idx = 0; idx < message.length; idx++) {
        $("#node-input-message-container").editableList('addItem', message[idx]);
      }
    }

  });
</script>

<script type="text/x-red" data-template-name="watson-text-speech">
<div class="form-row">
  <label for="node-input-name"><i class="icon-tag"></i> Name</label>
  <input type="text" id="node-input-name" placeholder="Name">
</div>

<div class="form-row">
  <label for="node-input-apikey"><i class="fa fa-key"></i> API Key</label>
  <input type="text" id="node-input-apikey" placeholder="Watson Speech Api Key">
</div>

<div class="form-row">
  <label for="node-input-endpoint"><i class="fa fa-globe"></i> URL</label>
  <input type="text" id="node-input-endpoint" placeholder="Watson Speech Endoint">
</div>

<div class="form-row">
        <label for="node-input-voice"><i class="fa fa-language"></i>Voice</label>
        <select type="text" id="node-input-voice" style="width:70%;">
          <option value="en-US_MichaelVoice">en-US_MichaelVoice</option>
          <option value="en-US_LisaVoice">en-US_LisaVoice</option>
          <option value="en-US_AllisonVoice">en-US_AllisonVoice</option>
          <option value="en-GB_KateVoice">en-GB_KateVoice</option>
          <option value="es-US_SofiaVoice">es-US_SofiaVoice</option>
          <option value="es-LA_SofiaVoice">es-LA_SofiaVoice</option>
          <option value="ja-JP_EmiVoice">ja-JP_EmiVoice</option>
          <option value="it-IT_FrancescaVoice">it-IT_FrancescaVoice</option>
          <option value="de-DE_DieterVoice">de-DE_DieterVoice</option>
          <option value="de-DE_BirgitVoice">de-DE_BirgitVoice</option>
          <option value="fr-FR_ReneeVoice">fr-FR_ReneeVoice</option>
          <option value="es-ES_LauraVoice">es-ES_LauraVoice</option>
          <option value="es-ES_EnriqueVoice">es-ES_EnriqueVoice</option>
          <option value="pt-BR_IsabelaVoice">pt-BR_IsabelaVoice</option>
        </select>
</div>
<div class="form-row node-input-rule-container-row">
  <ol id="node-input-message-container"></ol>
  <div style="max-width: 460px;font-size: 12px;color: #999999;line-height: 14px;clear:both;margin-top:5px;">
    <p>Supports <!-- handlebars-like variables for chat context like {{firstName}}, {{lastName}}, etc. and  -->emoticons (:smile:, etc.).</p>
    <p>In case of multiple version of the content, one will be randomly chosen.</p>
  </div>
</div>
<!-- <div class="form-row">
  <label for="node-input-answer"><i class="icon-share-alt"></i> Answer</label>
  <input type="checkbox" value="true" id="node-input-answer">
  <span style="max-width: 460px;font-size: 12px;color: #999999;line-height: 14px;">Quote the previous message <i>[Telegram]</i></span>
</div> -->
</script>
<script type="text/x-red" data-help-name="watson-text-speech">
<p>Watson Text To Speech node.</p>
<p>In your IBM portal create a text to speech service, you will be provided with an API key, copy the key and insert it in the API key section</p>
<p>Select your user language , by default it's english</p>
<p>The text need to be in <code>msg.payload.content</code> or in Text, QuickReply so Hanna bot will read it.</p>
<p>You can use SSML in order to add sentiment analysis <a href="https://console.bluemix.net/docs/services/text-to-speech/SSML.html#ssml" target="_blank">See more</a></p>
</script>


