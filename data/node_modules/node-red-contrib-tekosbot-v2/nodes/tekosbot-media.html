<script type="text/javascript">
$.ajax({url: '/appParams', 
        async: true,
        method: 'GET',
        success: (res) => {

}})
$('#sidebar').on('DOMNodeInserted', (e)=> {
   $.ajax({url: '/appParams', 
        async: true,
        method: 'GET',
        success: (res) => {
            if($('#urlFlow').text() && $('#urlFlow').text() == '/app?text=video' ){
                $('#urlFlow').text(`https://box.tekos.co/@${res.app_uri}.${res.app_name}/app?text=video`)
            }
        }})
})

RED.nodes.registerType('tekosbot-video', {

    category: 'Dialogue',
    color: '#91ffcd',
    defaults: {
      name: {
        value: ''
      },
      medias: {
        value: [],

        validate: function(medias) {
          var valid = true;
          var idx;
          
          for(idx = 0; idx < medias.length; idx++) {
            
             if (!$.RedBot.validate.src(medias[idx].src)) {
              valid = false;
          }
          return valid;
        }
      }
    }
    },
    inputs: 1,
    outputs: 1,
    paletteLabel: 'Video',
    icon: 'video.png',
    label: function() {
      return this.name || 'Video';
    },
    
   
    oneditsave: function() {
      var medias = $("#node-input-medias-container").editableList('items');
      var node = this;
      node.medias = [];

      var idx;
      for(idx = 0; idx < medias.length; idx++) {
        node.medias.push($(medias[idx]).RB_getMediaData('video'));
      }
    },


    oneditprepare: function() {
          $('#node-input-medias-container')
            .css('min-width','450px')
            .editableList({
              addButton: 'Add video',
              addItem: function(container, i, item) {
                $(container).RB_mountMediaDialog({
                  types: ['video'],
                  badges: false
                });
                $(container).RB_setButtonData(item, {
                  badges: false
                });
              },
              removable: true,
              sortable: true
            });
            
          var medias = this.medias;
          
          for (var idx = 0; idx < medias.length; idx++) {
            $('#node-input-medias-container').editableList('addItem', medias[idx]);
          };
    },


    oneditresize: function() {
      var dialogForm = $('#dialog-form');
      var rowName = $('.form-row-name', dialogForm);
      var rowMessage = $('.form-row-message', dialogForm);
      var rowLabel = $('.form-row-label', dialogForm);

      var height = dialogForm.height() - rowName.height() - rowLabel.height() - rowMessage.height() - 30;
      $('#node-input-medias-container').editableList('height', height);
    }
    
  });
$.ajax({url: '/appParams', 
        async: true,
        method: 'GET',
        success: (res) => {

}})
$('#sidebar').on('DOMNodeInserted', (e)=> {
   $.ajax({url: '/appParams', 
        async: true,
        method: 'GET',
        success: (res) => {
            if($('#urlFlowimage').text() && $('#urlFlowimage').text() == '/app?text=image' ){
                $('#urlFlowimage').text(`https://box.tekos.co/@${res.app_uri}.${res.app_name}/app?text=image`)
            }
        }})
})

  
 RED.nodes.registerType('tekosbot-image', {
    category: 'Dialogue',
    color: '#91ffcd',
    defaults: {
      name: {
        value: ''
      },
      medias: {
        value: [],
        validate: function(medias) {
          var valid = true;
          var idx;
          for(idx = 0; idx < medias.length; idx++) {
             if (!$.RedBot.validate.src(medias[idx].src)) {
              valid = false;
            }
           return valid;
          }
        }
      }
    },
    inputs: 1,
    outputs: 1,
    paletteLabel: 'Image',
    icon: 'chatbot-image.png',
    label: function() {
      return this.name || 'Image';
    },
    
   
    oneditsave: function() {
      var medias = $("#node-input-medias-container").editableList('items');
      var node = this;
      node.medias = [];
      var idx;
      for(idx = 0; idx < medias.length; idx++) {
        node.medias.push($(medias[idx]).RB_getMediaData('image'));
      }
    },


    oneditprepare: function() {
          $('#node-input-medias-container')
            .css('min-width','450px')
            .editableList({
              addButton: 'Add image',
              addItem: function(container, i, item) {
                $(container).RB_mountMediaDialog({
                  types: ['image'],
                  badges: false
                });
                $(container).RB_setMediaData(item, {
                  badges: false
                });

              },
              removable: true,
              sortable: true
            });
            
          var medias = this.medias;
          
          for (var idx = 0; idx < medias.length; idx++) {
            $('#node-input-medias-container').editableList('addItem', medias[idx]);

          };
    },


    oneditresize: function() {
      var dialogForm = $('#dialog-form');
      var rowName = $('.form-row-name', dialogForm);
      var rowMessage = $('.form-row-message', dialogForm);
      var rowLabel = $('.form-row-label', dialogForm);

      var height = dialogForm.height() - rowName.height() - rowLabel.height() - rowMessage.height() - 30;
      $('#node-input-medias-container').editableList('height', height);
    }
    
  });

  
</script>

<script type="text/x-red" data-template-name="tekosbot-video">
<div class="form-row form-row-name">
  <label for="node-input-name"><i class="icon-tag"></i> Name </label>
  <input type="text" id="node-input-name" placeholder="Name">
</div>
<div class="form-row form-row-label" style="margin-bottom:0;">
  <label><i class="fa fa-list"></i> <span>Video</span></label>
</div>
<div class="form-row node-input-rule-container-row">
  <ol id="node-input-medias-container"></ol>
</div>
</script>

<script type="text/x-red" data-help-name="tekosbot-video">
<h3>Node Video</h3> 
    <h6>Definition</h6> 
    <p>Used to send a video or a list of videos to the user.</p>
    <p>You can display videos on any messaging services (<b>eg</b>: hanna, facebook, slack…)</p>
    <h6>How it works</h6>
    <p>To display videos into hanna bot, you need to follow the following steps</p>
    <ul>
        <li>1. Set up hanna bot</li>
        <li>2. Link <b class="underline">hanna in</b> node before the video node</li>
        <li>3. Link <b class="underline">hanna out</b> node after the video node</li>
    </ul>
    <p>In order to display the video(s) in any other messaging service, you need to link the node “in” and “out” before and after the video node respectively (<b>eg</b>: facebook in > video > facebook out)</p>
    <h3>Send dynamic videos</h3>
    <p>To send videos dynamically you can add a function node with a similar code as below</p>
    <pre><code>
let videosUrls = [‘https://img1url’,‘https://img2url’]
let listVideos = []
for(videoSrc of videosUrls){
  listVideos.push({type: ‘video’,src: videoSrc})
}
msg.payload = {
  type: “media”,
  medias: listVideos,
}
return msg
</code></pre>
    <h6>Channels</h6>
    <p><img src="https://img.shields.io/badge/Platform-Hanna-blue.svg?colorB=009f9d" alt="Hanna">
    <p><img src="https://img.shields.io/badge/platform-Slack-green.svg" alt="Slack">
    <p><img src="https://img.shields.io/badge/platform-Facebook-blue.svg" alt="Facebook">
    <h6>Example</h6>
    <p>Go to <b>menu > import > library > Apps Templates > Defaults</b> and click on <b>video.</b></p>
    <p><b>Visit the url to test it</b> <code id="urlFlow">/app?text=video</p>

</script>

<script type="text/x-red" data-template-name="tekosbot-image">
<div class="form-row form-row-name">
  <label for="node-input-name"><i class="icon-tag"></i> Name</label>
  <input type="text" id="node-input-name" placeholder="Name">
</div>

<div class="form-row form-row-label" style="margin-bottom:0;">
  <label><i class="fa fa-list"></i> <span>Image</span></label>
</div>
<div class="form-row node-input-rule-container-row">
  <ol id="node-input-medias-container"></ol>
</div>
</script>

<script type="text/x-red" data-help-name="tekosbot-image">
<h3>Node Image</h3> 
    <h6>Definition</h6> 
    <p>Used to send an image or a list of images to the user.</p>
    <p>You can display Images on any messaging services (<b>eg</b>: hanna, facebook, slack…)</p>
    <h6>How it works</h6>
    <p>To display images into hanna bot, you need to follow the following steps</p>
    <ul>
        <li>1. Set up hanna bot</li>
        <li>2. Link <b class="underline">hanna in</b> node before the image node</li>
        <li>3. Link <b class="underline">hanna out</b> node after the image node</li>
    </ul>
    <p>In order to display the image(s) in any other messaging service, you need to link the node “in” and “out” before and after the image node respectively (<b>eg</b>: facebook in > image > facebook out)</p>
    <h3>Send dynamic images</h3>
    <p>To send images dynamically you can add a function node with a similar code as below</p>
    <pre><code>
          let imagesUrls = [‘https://img1url’,‘https://img2url’]
          let listImages = []
          for(imgSrc of imagesUrls){
            listImages.push({type: ‘image’,src: imgSrc})
          }
          msg.payload = {
            type: “media”,
            medias: listImages,
          }
          return msg
    </code></pre>
    <h6>Channels</h6>
    <p><img src="https://img.shields.io/badge/Platform-Hanna-blue.svg?colorB=009f9d" alt="Hanna">
    <p><img src="https://img.shields.io/badge/platform-Slack-green.svg" alt="Slack">
    <p><img src="https://img.shields.io/badge/platform-Facebook-blue.svg" alt="Facebook">
    <h6>Example</h6>
    <p>Go to <b>menu > import > library > Apps Templates > Defaults</b> and click on <b>image.</b></p>
    <p>Visit the url <code id="urlFlowimage">/app?text=image</p>

</script>

<style type="text/css">
.underline{
    text-decoration: underline;
}
</style>
