<script type="text/javascript">
$.ajax({url: '/appParams', 
        async: true,
        method: 'GET',
        success: (res) => {

}})
$('#sidebar').on('DOMNodeInserted', (e)=> {
        $.ajax({url: '/appParams', 
        async: true,
        method: 'GET',
        success: (res) => {
            if($('#urlFlow').text() && $('#urlFlow').text() == '/app?text=context' ){
                $('#urlFlow').text(`https://box.tekos.co/@${res.app_uri}.${res.app_name}/app?text=context`)
            }
        }})
     })

  RED.nodes.registerType('chatbot-context', {
    category: 'Dialogue',
    color: '#ffedc6',
    defaults: {
      name: {
        value: ''
      },
      variable: {
        value: ''
      },
      operation: {
        value: 'set'
      },
      property: {
        value: 'uid'
      },
      text: {
        value: ''
      }
    },
    inputs: 1,
    outputs: 1,
    paletteLabel: 'Context',
    icon: 'chatbot-context.png',
    align: 'left',
    label: function() {
      return this.name || 'Context';
    },
    oneditsave: function() {
  
    },

    oneditprepare: function() {
      $('#node-input-operation').on('change', ()=>{
        if($('#node-input-operation').val() == 'get'){
          $("#row-text").hide()
        }else{
          $("#row-text").show()

        }
      })
    }
  });
</script>

<script type="text/x-red" data-template-name="chatbot-context">

<div class="form-row">
  <label for="node-input-name"><i class="icon-tag"></i> Name</label>
  <input type="text" id="node-input-name" placeholder="Name">
</div>
<div class="form-row">
  <label for="node-input-variable"><i class="icon-tag"></i> Variable Name</label>
  <input type="text" id="node-input-variable" placeholder="Variable name">
</div>
<div class="form-row">
  <label for="node-input-operation"><i class="icon-tag"></i> Operation</label>
  <select id="node-input-operation">
    <option value="get">Get</option>
    <option value="set">Set</option>
  </select>
</div>
<div class="form-row">
  <label for="node-input-property"><i class="icon-tag"></i> Property</label>
  <input type="text" id="node-input-property" placeholder="(eg: uid, conversationId ...)">
</div>
<div class="form-row" id="row-text" >
  <label for="node-input-text"><i class="icon-tag"></i> Value</label>
  <input type="text" id="node-input-text" placeholder="text or {{payload.value}}">
</div>


</script>
<script type="text/x-red" data-help-name="chatbot-context">
<h3>Tekos Context</h3> 
    <h6>Definition</h6> 
    <p>Used to store context values and access them later with the same property.</p>
    <p>You may need to store variables related to your users and get them later in the flow, you can use this node to save and restore properties based on a msg property (exp: msg.uid)</p>
    <h6>How it works</h6>
    <ul>
        <li>1. Set new variable:
          <ul>
              <li>a. Set a new variable by selecting “Set” operation</li>
              <li>b. Add a new variable name</li>
              <li>c. Add the basic property you need to rely on when you get the value</li>
              <li>d. Add a text or object value under msg object, using direct string or mustache template {{payload.value}}</li>
          </ul>
        </li>
        <li>2. Get Variable:
          <ul>
              <li>a. Select “Get” operation</li>
              <li>b. Write the variable name you added when using “Set”</li>
              <li>c. Keep the same property as the context “Set” node</li>
              <li>d. Your variable value will be returned in <b>msg.payload</b></li>
          </ul>
        </li>
    </ul>

    <h6>Channels</h6>
    <p><img src="https://img.shields.io/badge/Platform-Hanna-blue.svg?colorB=009f9d" alt="Hanna">
    <h6>Example</h6>
    <p>Go to <b>menu > import > library > Apps Templates > Defaults</b> and click on <b>context</b></p>
    <p>Visit the url <a target="_BLANK" href="https://box.tekos.co/@{app_uri}.{app_name}/app?text=context">https://box.tekos.co/@{app_uri}.{app_name}/app?text=context</a></p>
</script>


