module.exports = function(RED) {
    "use strict";

    /****************************** TEKOS PERSISTENT MENU *******************************/
	function PersistentMenu(config) {
		var node = this ;
	    RED.nodes.createNode(this, config);
		node.on("input", function(msg){
			var elements = []
			for (var i = 0; i < config.options.length; i++) {
				let elt = config.options[i]
				let menu = {}
				if(elt.type === "postback"){
					menu = {
			 	        "title":elt.label,
			 	        "type":elt.type,
			 	        "message": elt.value,
			 	        "color": "primary",
			 	        "icon": elt.icon,
			 	        "silent": true
			 	    }
				}else if(elt.type === "url"){
					menu = {
			 	        "title":elt.label,
			 	        "type":elt.type,
			 	        "url": elt.url,
			 	        "color": "primary",
			 	        "icon": elt.icon,
			 	        "silent": true
			 	    }
				}

			 	elements.push(menu)
			}

			msg.payload = {
				"persistent_menu":
				 	{
				 	    "horizontal": true,
				 	    "call_to_actions": elements
				 	}
			}
			node.send(msg);	
        });		

    }
	RED.nodes.registerType("tekos-persistent-menu",PersistentMenu); 
};